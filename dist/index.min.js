const container=document.querySelector(".canvas-container"),canvasEl=document.querySelector("#canvas"),fragmentShader="\nvarying vec2 vUv;\n\t\n\tuniform float u_ratio;\n\tuniform float u_time;\n\tuniform float u_width;\n\tuniform vec4 u_theme;\n\tuniform float u_speed;\n\tuniform vec2 u_point;\n\n\t// Ashima noise\n\t// https://github.com/stegu/webgl-noise/blob/893dacd869c7fafe8f60fd658ae6030761ce247d/src/noise2D.glsl\n\tvec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }\n\tfloat snoise(vec2 v){\n\t\tconst vec4 C = vec4(0.211324865405187, 0.366025403784439,\n        -0.577350269189626, 0.024390243902439);\n\t\tvec2 i = floor(v + dot(v, C.yy));\n\t\tvec2 x0 = v - i + dot(i, C.xx);\n\t\tvec2 i1;\n\t\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t\tvec4 x12 = x0.xyxy + C.xxzz;\n\t\tx12.xy -= i1;\n\t\ti = mod(i, 289.0);\n\t\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\t\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy),\n\t\tdot(x12.zw, x12.zw)), 0.0);\n\t\tm = m*m;\n\t\tm = m*m;\n\t\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\t\tvec3 h = abs(x) - 0.5;\n\t\tvec3 ox = floor(x + 0.5);\n\t\tvec3 a0 = x - ox;\n\t\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\t\tvec3 g;\n\t\tg.x = a0.x * x0.x + h.x * x0.y;\n\t\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\t\treturn 130.0 * dot(m, g);\n\t}\n\n\t// Colour conversion\n\t// https://gist.github.com/983/e170a24ae8eba2cd174f\n\t// vec3 hsv2rgb(vec3 c) {\n\t// \tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t// \tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t// \treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n\t// }\n\t\n\tfloat hue2rgb(float f1, float f2, float hue) {\n\t\t if (hue < 0.0)\n\t\t\t  hue += 1.0;\n\t\t else if (hue > 1.0)\n\t\t\t  hue -= 1.0;\n\t\t float res;\n\t\t if ((6.0 * hue) < 1.0)\n\t\t\t  res = f1 + (f2 - f1) * 6.0 * hue;\n\t\t else if ((2.0 * hue) < 1.0)\n\t\t\t  res = f2;\n\t\t else if ((3.0 * hue) < 2.0)\n\t\t\t  res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\t\t else\n\t\t\t  res = f1;\n\t\t return res;\n\t}\n\n\tvec3 hsl2rgb(vec3 hsl) {\n\t\t vec3 rgb;\n\n\t\t if (hsl.y == 0.0) {\n\t\t\t  rgb = vec3(hsl.z); // Luminance\n\t\t } else {\n\t\t\t  float f2;\n\n\t\t\t  if (hsl.z < 0.5)\n\t\t\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\t\t  else\n\t\t\t\t\tf2 = hsl.z + hsl.y - hsl.y * hsl.z;\n\n\t\t\t  float f1 = 2.0 * hsl.z - f2;\n\n\t\t\t  rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));\n\t\t\t  rgb.g = hue2rgb(f1, f2, hsl.x);\n\t\t\t  rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));\n\t\t }   \n\t\t return rgb;\n\t}\n\n\tvec3 hsl2rgb(float h, float s, float l) {\n\t\t return hsl2rgb(vec3(h, s, l));\n\t}\n\n\tfloat get_noise(vec2 uv, float t){\n\t\tfloat SCALE = 5.;\n\t\tfloat noise = snoise(vec2(uv.x * .9 * SCALE, -uv.y * SCALE - t));\n\t\tSCALE = 7.;\n\t\tnoise += .2 * snoise(vec2(uv.x * SCALE + 3. * t, uv.y * .8 * SCALE));\n\t\tnoise += 1.1;\n\t\treturn noise;\n\t}\n\n\tfloat circle_s (vec2 dist, float radius) {\n\t\treturn smoothstep(0., radius, pow(dot(dist, dist), .3) * .1);\n\t}\n\n\tvoid main () {\n\t\tvec2 uv = vUv;\n\t\tuv /= (4000. / u_width);\n\t\tuv.y /= u_ratio;\n\n\t\tvec2 mouse = vUv - u_point;\n\t\tmouse.y /= u_ratio;\n\n\t\tfloat t = u_time * u_speed;\n\n\t\tfloat noise = get_noise(uv, t);\n\t\tnoise *= circle_s(mouse, .09);\n\n\t\tconst float STEPS = 2.;\n\t\tfloat stepped_noise = floor(noise * STEPS) / STEPS;\n\t\t\n\t\t//float d = -.5 * pow(stepped_noise, .5);\n\t\tfloat d = -.5 * stepped_noise;\n\t\n\t\tvec3 hsl = vec3(u_theme[0], u_theme[1], u_theme[2] + d * u_theme[3]);\n\t\tvec3 color = hsl2rgb(hsl);\n\n\t\tgl_FragColor = vec4(color, 1.);\n\t}",vertexShader="\nvarying vec2 vUv;\n\t\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = vec4(position, 1.);\n}";let renderer,scene,camera,clock,material,pointer=new THREE.Vector2(.5,.5),targetPointer=new THREE.Vector2(.5,.5);const themes={green:new THREE.Vector4(.51,.97,.31,.09),light:new THREE.Vector4(.5,.84,.98,.16),dark:new THREE.Vector4(.62,.43,.14,.08)},params={speed:.03,theme:themes.dark};function updateMousePosition(t,e){targetPointer.x=t/window.innerWidth,targetPointer.y=1-e/window.innerHeight}function initScene(){renderer=new THREE.WebGLRenderer({alpha:!0,canvas:canvasEl}),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),scene=new THREE.Scene,camera=new THREE.OrthographicCamera(-.5,.5,.5,-.5,.1,10),clock=new THREE.Clock,material=new THREE.ShaderMaterial({uniforms:{u_point:{type:"v2",value:pointer},u_resolution:{type:"v2",value:new THREE.Vector2(0,0)},u_time:{type:"f",value:0},u_ratio:{type:"f",value:window.innerWidth/window.innerHeight},u_width:{type:"f",value:window.innerWidth},u_theme:{type:"v3",value:params.theme},u_speed:{type:"f",value:params.speed}},vertexShader:vertexShader,fragmentShader:fragmentShader,transparent:!0}),container.addEventListener("click",(t=>{e.material.uniforms.u_theme.value=themes.light}));const t=new THREE.PlaneGeometry(2,2),e=new THREE.Mesh(t,material);scene.add(e),updateSceneSize(),render()}function render(){pointer.x+=.1*(targetPointer.x-pointer.x),pointer.y+=.1*(targetPointer.y-pointer.y),material.uniforms.u_point.value=pointer,material.uniforms.u_time.value=clock.getElapsedTime(),renderer.render(scene,camera),requestAnimationFrame(render)}function updateSceneSize(){material.uniforms.u_ratio.value=window.innerWidth/window.innerHeight,material.uniforms.u_width.value=window.innerWidth,renderer.setSize(container.clientWidth,container.clientHeight)}container&&canvasEl&&initScene(),window.addEventListener("resize",updateSceneSize),window.addEventListener("mousemove",(t=>{updateMousePosition(t.clientX,t.clientY)})),window.addEventListener("touchmove",(t=>{updateMousePosition(t.targetTouches[0].pageX,t.targetTouches[0].pageY)}));const questions=[{id:1,content:"intro",question:"<p>Welcome!</p><p>What would you like to see?</p>",answers:[{label:"Do you do development?",type:"content",target:6},{label:"Who are you?",type:"content",target:2},{label:"View blog posts",type:"link",target:"https://www.inktrap.co.uk/insights"}]},{id:2,content:"about-inktrap",question:"<p>Here's some more about Inktrap!</p>",answers:[{label:"More info?",type:"question",target:8}]},{id:3,content:null,question:"<p>What industry would be most relevant?</p>",answers:[{label:"Insurtech",type:"content",target:4},{label:"Fintech",type:"content",target:5}]},{id:4,content:"insurtech-work",question:"<p>Insurtech is one of our specialities</p><p>What's next?</p>",answers:[{label:"More about Inktrap",type:"content",target:2},{label:"View blog posts",type:"link",target:"https://www.inktrap.co.uk/insights"}]},{id:5,content:"insurtech-work",question:"<p>Insurtech is one of our specialities</p><p>What's next?</p>",answers:[{label:"More info?",type:"question",target:8}]},{id:6,content:"dev-info",question:"<p>Here's our dev info</p>",answers:[{label:"More info?",type:"question",target:8}]},{id:7,content:"insurtech-work",question:"<p>Insurtech is one of our specialities</p><p>What's next?</p>",answers:[{label:"More about Inktrap",type:"question",target:8}]},{id:8,content:null,question:"<p>The final loop-</p><p>What else would you like to see?</p>",finalLoop:!0,answers:[{id:1,label:"Who are you?",type:"content",target:"about-inktrap",connectedQuestion:2},{id:2,label:"Do you do development?",type:"content",target:"dev-info",connectedQuestion:6},{id:3,label:"More about your experience",type:"content",target:"our-experience"}]},{id:9,content:"dev-info",question:"<p>Here's XYZ</p>",answers:[{label:"More info?",type:"question",target:8}]}],INITIAL_QUESTION_ID=1,initialQuestion=questions.find((t=>1===t.id));let chosenAnswers=[],chosenFinalAnswers=[];const contentContainer=document.querySelector("[data-container=content]"),questionContainer=document.querySelector("[data-container=question]"),answerContainer=document.querySelector("[data-container=answers]");contentContainer&&questionContainer&&answerContainer&&updateQuestionAndAnswers(initialQuestion.question,initialQuestion.answers);const stringContent=async()=>await axios.get(window.location.href+"content.html").then((t=>t.data)).catch((t=>{console.log(t)})),parser=new DOMParser,content=parser.parseFromString(stringContent,"text/html");function answersHtml(t,e=!1){if(e){let e=0;const n=t.map((t=>{if(!chosenAnswers.includes(t.connectedQuestion)&&!chosenFinalAnswers.includes(t.id))return e++,`\n          <button class="button" data-id="${t.id}" data-finalLoop=true data-type="${t.type}" data-target="${t.target}">\n            ${t.label}\n          </button>\n        `}));return e>0?n.join(""):'<button class="button" data-type="link" data-target="https://www.inktrap.co.uk/insights">Contact us</button>'}return t.map((t=>`\n          <button class="button" data-type="${t.type}" data-target="${t.target}">\n            ${t.label}\n          </button>\n        `)).join("")}function updateQuestionAndAnswers(t,e,n=!1){questionContainer.innerHTML=t,answerContainer.innerHTML=answersHtml(e,n),addListenerToButtons()}function addListenerToButtons(){document.querySelectorAll("[data-target]").forEach((function(t){"link"===t.dataset.type&&t.addEventListener("click",(function(e){window.open(t.dataset.target,"_self")})),"question"===t.dataset.type&&t.addEventListener("click",loadQuestion),"content"===t.dataset.type&&t.dataset.finalloop?t.addEventListener("click",loadFinalContent):t.addEventListener("click",loadContent)}))}function loadContent(t){const e=questions.findIndex((e=>e.id==t.target.dataset.target)),n=content.querySelector("[data-content="+questions[e].content+"]");updateQuestionAndAnswers(questions[e].question,questions[e].answers,questions[e].finalLoop),n&&(contentContainer.innerHTML+=n.outerHTML,document.querySelector("[data-content="+questions[e].content+"]").scrollIntoView({behavior:"smooth"}),chosenAnswers.push(Number(t.target.dataset.target)))}function loadFinalContent(t){const e=questions.findIndex((t=>t.finalLoop)),n=content.querySelector("[data-content="+t.target.dataset.target+"]");chosenFinalAnswers.push(Number(t.target.dataset.id)),updateQuestionAndAnswers(questions[e].question,questions[e].answers,!0),n&&(contentContainer.innerHTML+=n.outerHTML,document.querySelector("[data-content="+questions[e].answers[t.target.dataset.id-1].target+"]").scrollIntoView({behavior:"smooth"}))}function loadQuestion(t){const e=questions.findIndex((e=>e.id==t.target.dataset.target));updateQuestionAndAnswers(questions[e].question,questions[e].answers,questions[e].finalLoop),chosenAnswers.push(Number(t.target.dataset.target))}const resetButton=document.querySelector("[data-content=reset]");function handleReset(){chosenAnswers=[],chosenFinalAnswers=[],contentContainer.innerHTML="",updateQuestionAndAnswers(initialQuestion.question,initialQuestion.answers)}resetButton&&resetButton.addEventListener("click",handleReset);const headingContainer=document.querySelector(".heading__container"),text=document.querySelector(".content__text");if(headingContainer&&text){const t=text.cloneNode(!0);t.setAttribute("aria-hidden","true"),headingContainer.appendChild(t)}Splitting();const wrapElements=(t,e,n)=>{t.forEach((t=>{const o=document.createElement(e);o.classList=n;t.parentNode.insertBefore(o,t),o.appendChild(t)}))},splittingOutput=Splitting(),texts=[...document.querySelectorAll(".content__text")];let currentTextPos=0,isAnimating=!1;texts[currentTextPos]&&texts[currentTextPos].classList.add("content__text--current"),wrapElements(splittingOutput.map((t=>t.words)).flat(),"span","word-wrap");const switchTexts=()=>{if(isAnimating)return!1;isAnimating=!0;const t=currentTextPos?0:1,e=splittingOutput[currentTextPos].words,n=splittingOutput[t].words;gsap.timeline({defaults:{duration:.05,ease:"expo"},onComplete:()=>{currentTextPos=t,isAnimating=!1}}).fromTo(e,{willChange:"transform",transformOrigin:"100% 50%",yPercent:0,rotation:0},{duration:.2,ease:"power1.in",yPercent:-125,rotation:3,stagger:{each:.02,from:"start"},onComplete:()=>{texts[currentTextPos].classList.remove("content__text--current")}}).fromTo(n,{willChange:"transform",transformOrigin:"0% 50%",yPercent:125,rotation:-3},{onStart:()=>{texts[t].classList.add("content__text--current")},duration:.7,delay:.2,ease:"back",yPercent:0,rotation:0,stagger:{each:.02,from:"start"}},">-=0.6"),texts[0].setAttribute("aria-hidden","true"),texts[1].setAttribute("aria-hidden","false")};document.querySelector(".content__text")&&document.querySelector(".content__text").addEventListener("click",switchTexts),window.onload=function(){let t=document.querySelectorAll(".grid-2col:has(.card)");for(let e=0;e<t.length;e++){t[e].classList.add("aos-grid-"+e);let n=t[e].querySelectorAll(".card");for(let t=0;t<n.length;t++)n[t].setAttribute("data-aos","fade-up"),n[t].setAttribute("data-aos-anchor",".aos-grid-"+e),n[t].setAttribute("data-aos-delay",100*t)}setTimeout((()=>{AOS.init({easing:"ease-out"})}),50)};const storageKey="theme-preference",systemTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";function getThemePreference(){return localStorage.getItem(storageKey)?localStorage.getItem(storageKey):"system"}function storeThemePreference(t){localStorage.setItem(storageKey,t)}function removeThemePreference(){localStorage.removeItem(storageKey)}function updateTheme(t){document.firstElementChild.setAttribute("data-theme",t)}function initTheme(){const t=getThemePreference();updateTheme("system"==t?systemTheme:t)}window.addEventListener("load",(function(){const t=document.querySelector("[data-theme-dropdown]");t&&(t.value=getThemePreference(),t.addEventListener("change",(function(){"system"==t.value?(updateTheme(systemTheme),removeThemePreference()):(updateTheme(t.value),storeThemePreference(t.value))})))})),console.log(systemTheme),console.log(getThemePreference()),initTheme();
